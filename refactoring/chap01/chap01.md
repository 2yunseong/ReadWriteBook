# 리팩터링: 첫번째 예시

### 예시 프로그램을 본 소감

설계가 나쁜 시스템은 수정하기 어렵다.

**프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.**

추후 사용자의 입맛에 맞게 수정할 부분이 있다면?

1. 연극부원들이 사극, 전원극, 등 다양한 연기를 하고 싶다면?
    - 적립포인트 계산법 수정 되어야 함
    - switch 문 수정되어야 한다.

### 리팩터링의 첫 단계
리팩터링의 첫 단계는 항상 똑같다. 리팩터링할 코드 영역을 꼼꼼하게 검사해줄 테스트 코드들 부터 마련해야 한다.

리팩터링에서 테스트의 역할을 굉장히 중요하다.

예제에서 `statement()` 테스트는 어떻게 구성하면 될까?

이 함수가 문자열을 반환하므로, 다양한 장르의 공연들로 구성된 공연료 청구서 몇 개를 미리 작성하여 실행할 수 있도록 설정한다.(테스트 프레임워크 이용)

테스트 결과는 자가 진단이 가능하게 설정

*리팩터링하기 전에 제대로 된 테스트부터 마련한다. 테스트는 반드시 자가진단 하도록 만든다.*

### statement() 함수 쪼개기

1. 전체 메서드의 동작을 각각의 부분으로 나눌 수 있는 지점을 찾는다.
   - 코드를 분석해야만 무엇을 하는 코드인지 아는 코드
2. 분리하려는 코드가 하는 일에 걸맞는 이름 지어주기
3. 별도 함수로 빼냈을 때 유효 범위를 벗어나는 변수가 있는지 확인
    - 변경 되지 않는 값은 매개변수로 전달
    - 값이 바뀌는 변수는 조심해서 다뤄야 한다.
4. **추출하고 나면 지금보다 명확하게 표현할 수 있는 간단한 방법은 없는지 검토.**


수정하면 곧바로 컴파일 -> 테스트 하며 실수한게 없는지 확인
- 한가지를 수정할 때 마다 테스트 하면 변경 폭이 작아 살펴볼 범위도 좁아 문제를 찾고 해결하기 용이하다.
- **조금씩 변경하고 매번 테스트하는 것은 리팩터링 절차의 핵심**
- 저자는 하나의 리팩터링을 문제없이 끝낼 때마다 커밋한다. -> 중간에 문제가 생기더라도 쉽게 돌아갈 수 있기 때문.
- 이런 자잘한 변경들이 어느새 의미 있는 단위로 뭉쳐지면 공유 저장소로 Push.

*리팩터링은 프로그램 수정을 작은 단계로 나눠 진행한다. 그래서 중간에 실수하더라도 버그를 쉽게 찾을 수 있다.*

### 임시변수 제거하기
임시변수들 때문에 로컬 범위에 존재하는 이름이 늘어나서 추출 작업이 복잡해진다. 따라서 지역 변수를 

이를 해결하기 위해 임시 변수를 질의 함수로 바꾼다.

> 질의 함수란 ? 연산을 통해 답을 구하는 행위

### 변수 인라인 하기

질의 함수를 인라인 한다. 임시변수를 제거하고 위에서 만든 질의 함수를 이용해 인라인.

